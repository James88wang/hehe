<!DOCTYPE html>
<html lang="en">

<head>
  <% include partials/head %>
</head>

<body class="container">
  <div class="col-md-6 col-md-offset-3">
    <h1>Hello <%- name %></h1>
    <button class="btn btn-success" id="show-metrics">
      Bring the metrics
    </button>

    <button class="btn btn-danger" href="/logout" onClick='document.location.href="/logout"'>
      Logout
    </button>

    <button class="btn btn-danger " id="delete" type="submit" value="delete">
      Delete
    </button>


    <form action="/metrics" method="post">

      <div class="form-group">
        <label for="form_m_name"> m_name </label>
        <input id="form_m_name" type="text" name="m_name" />
      </div>
      <div class="form-group">
        <label for="form_number"> Value </label>
        <input id="form_number" type="number" name="value" />
      </div>
      <button class="btn btn-success " type="submit" value="post">
        Post metric
      </button>
    </form>

      <button class="btn btn-primary " id="allMetrics">
        Get All Metrics
      </button>

    <div id="metrics"></div>
  </div>

  <% if(name) { %>
  <script>
    const username = <% - name %>
  </script>
  <% } %>


  <script>
      $('#show-metrics').click((e) => {
        e.preventDefault();
        $.getJSON("/metrics.json", {}, (data) => {
          const content = data.map(d => {
            return 'timestamp: ' + d.timestamp + ', value: ' + d.value + '';
          })
          $('#metrics').append(content.join("\n"));
        });
      })

    $('#delete').click((e) => {
      e.preventDefault();
      $.ajax({
        async: true,
        url: '/user/' + username,
        type: 'DELETE',
        contentType: 'application/json',
        success: () => {
          window.location.replace('/login')
        }
      })
    })

    $('#allMetrics').click((e) => {
      e.preventDefault();
      $.ajax({
        async: true,
        url: '/metrics',
        type: 'GET',
        contentType: 'application/json',
        success: (response) => {
          $.getJSON("/metrics", {}, (data) => {
            const content = data.map(d => {
              return   'm_name: ' + d.m_name + ',timestamp: ' + d.timestamp + ', value: ' + d.value + '\n' ;
            })
            $('#metrics').append(content.join("\n"));
          });
        }
      })
    })

  </script>
</body>

</html>